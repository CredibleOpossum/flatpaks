#!/usr/bin/env bash

# Pre-work
if [ ! -f /var/data/server.txt ]; then
    echo ZWxvY2hhdC55ZWVrLmFnZW5jeSVlbG9jaGF0LnllZWsuYWdlbmN5JQ0K | base64 -d > /var/data/server.txt
fi
if [ ! -f /var/data/config.txt ]; then
    echo "W0Vsb25hIENvbmZpZ10NCg0KQmUgc3VyZSB0byBtYWtlIGEgYmFja3VwIGZpbGUgYmVmb3JlIGVkaXRpbmcuDQoNCihHZW5lcmFsKQ0KbGFuZ3VhZ2UuCSIxIgkJMD1KYXBhbmVzZSAxPUVuZ2xpc2ggLTE9YXNrDQptc2dfYm94LgkiMCIJCTA9d2luZG93cyBtZXNzYWdlIGJveCAxPW9yaWdpbmFsIG1lc3NhZ2UgYm94DQphbGVydF93YWl0LgkiNTAiCQl0eHQgd2FpdCx3aGVuIGltcG9ydGFudCB0aGluZ3MgaGFwcGVuDQphbmltZV93YWl0LgkiMjAiCQlhbmltYXRpb24gd2FpdCAoMD1kaXNhYmxlIGFsbCBhbmltYXRpb25zKQ0Kc3RvcnkuCQkiMSIJCTA9ZGlzYWJsZSBzdG9yeQkxPWVuYWJsZSBzdG9yeQ0KZXh0cmFSYWNlLgkiMCIJCTA9b2ZmaWNpYWwgcmFjZXMgMT1kZWJ1ZyByYWNlcw0KdGl0bGVFZmZlY3QuCSIxIg0KZXh0cmFIZWxwLgkiMSINCnJlY29yZC4JIjEiDQphdGtfc2VsZWN0LgkiMCINCmR1c3Rfc2VsZWN0LiAiMCINCg0Kc3RhcnRSdW4uCSIyIg0KYXR0YWNrV2FpdC4JIjIiDQp3YWxrV2FpdC4JIjQiDQphdXRvVHVyblR5cGUuCSIwIg0KcnVuV2FpdC4JIjIiDQphdXRvTnVtbG9jay4JIjEiDQpuZXQuIAkJIjEiDQpuZXRXaXNoLgkiMSINCm5ldENoYXQuIAkiMCINCmpveXBhZC4JCSIxIg0Kc2VydmVyTGlzdC4JIjEiCQkwPWF1dG8gcmV0cmlldmUgMT1kaXNhYmxlIGF1dG8gcmV0cmlldmUNCmRlZkxvYWRGb2xkZXIuCSIiCQlUaGUgc2F2ZWQgZ2FtZSBpbiB0aGUgZm9sZGVyIHdpbGwgYmUgYXV0b21hdGljYWxseSBsb2FkZWQgYWZ0ZXIgbGF1bmNoaW5nIHRoZSBnYW1lLg0KCQkJCShVc2UgYSBmb2xkZXIgbmFtZSB1bmRlciB0aGUgXHNhdmUgZm9sZGVyLiBpZS4ic2F2X3BsYXllciIgKQ0KY2hhcmFtYWtlX3dpei4JIjAiDQpza2lwUmFuZEV2ZW50cy4JIjAiDQpkYW1hZ2Vfc2hvdy4JIjEiDQpjaGFyYW1ha2VfcHJlY2lzZVN0YXRzLgkiMCIJCTE9U2hvdyBleGFjdCBzdGF0IG51bWJlcnMgZHVyaW5nIHJhY2UvY2xhc3MgY3JlYXRpb24NCg0KDQooR2FtZSBwbGF5KQ0KaWdub3JlRGlzbGlrZS4JIjEiCQkxPWRpc3BsYWNlIGhhcm1sZXNzIE5QQ3MgbGlrZSB0b3duIGNoaWxkcmVuIHdoZW4gbW92aW5nDQoNCg0KKFNjcmVlbikNCmZ1bGxzY3JlZW4uCSIwIg0Kd2luZG93WC4JIjAiDQp3aW5kb3dZLgkiMCINCndpbmRvd1cuCSI4MDAiCQlzY3JlZW4gd2lkdGggKG1pbiA4MDAgZG90cykgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDQNCndpbmRvd0guCSI2MDAiCQlzY3JlZW4gaGVpZ2h0KG1pbiA2MDAgZG90cykgbXVzdCBiZSBhIG11bHRpcGxlIG9mIDQNCmhpZ2hEUElTY2FsaW5nLgkiMS4wIg0KaGlnaERQSVNtb290aGluZy4JIjAiDQp3aW5kb3dBbmltZS4JIjAiCQkwPWRpc2FibGUgd2luZG93IHBvcCB1cCBhbmltYXRpb24gMT1lbmFibGUNCnNjcm9sbC4JCSIxIg0Kc2Nyb2xsX3J1bi4JIjEiDQphbHdheXNDZW50ZXIuCSIxIg0KZW52RWZmZWN0LgkiMSINCmF0dGFja0FuaW1lLiAJIjEiDQpleEFuaW1lLgkiMSINCnNoYWRvdy4JCSIwIg0Kb2JqZWN0U2hhZG93LgkiMSINCnNjcl9zeW5jLgkiMiINCm1zZ190cmFucy4JIjQiDQptc2dfYWRkVGltZS4JIjEiDQoNCnRpdGxlX2RpYWxvZy4JIjEiDQoNCnNob3dGcHMuICIwIg0Kc2hvd1RvcFRpbGVDdXRvZmYuICIwIg0KDQooU291bmQpDQpzb3VuZC4JCSIxIg0KbXVzaWMuCQkiMSINCmhlYXJ0YmVhdC4JIjEiDQoNCihGb250KQ0KZm9udDEuCQkigmyCciCDU4NWg2KDTiIJdXNlZCBpbiBKYXBhbmVzZQkvUGxlYXNlIHVzZSBtb25vc3BhY2UgZm9udHMNCmZvbnQyLgkJIkNvdXJpZXIgTmV3Igl1c2VkIGluIEVuZ2xpc2gJCS9saWtlIEx1Y2lkYSBDb25zb2xlIGZvbnQuDQoNCihtZXNzYWdlKQ0KaGlkZV9hdXRvSWRlbnRpZnkuCSIwIgkwPXNob3cgYWxsCTE9aGlkZSBtc2cocXVhbGl0eSkJMj1oaWRlIGFsbCBtc2cNCmhpZGVfc2hvcFJlc3VsdC4JIjAiCTA9c2hvdyBhbGwJMT1oaWRlIG1zZyhubyBpbmNvbWUpCTI9aGlkZSBhbGwgbXNnDQoNCkxpbmVzIGJlbG93IGFyZSBvbmx5IGFwcGxpZWQgaW4gRW5nbGlzaCBtb2RlLg0KDQpmb250VmZpeDEuCSItMSIJCWZpeGVzIHZlcnRpY2FsIHBvc2l0aW9uKA0KZm9udFNmaXgxLgkiMSIJCWZpeGVzIGZvbnQgc2l6ZQ0KZm9udFdTSFBhZC4JIjAiICAgICAgICAgICAgZml4ZXMgd2hpdGUgc3BhY2VzIGNhdXNlZCBieSBmb250J3MgSFcgcmF0aW8NCg0KKHVuYXZhaWxhYmxlKQkJCXBsZWFzZSBkbyBub3QgY2hhbmdlDQptc2dfbG9nLgkiMTYiDQp3YWl0MS4JCSIzMCINCmluZlZlclR5cGUuCSIxIg0KY2xvY2tYLgkJIjAiDQpjbG9ja1cuCQkiMTIwIg0KY2xvY2tILgkJIjk2Ig0KZm9udFNpemUuCSIxNCINCmZvbnRTaXplIC4JIjE0Ig0KbXNnTGluZS4JIjQiDQp0aWxlU2l6ZS4JIjQ4Ig0KDQoNCihLZXlib2FyZCBzcGVjaWFsIGZ1bmN0aW9uKQ0Ka2V5X3NDYW5jZWwuCSIxIgkJdXNlIHNoaWZ0IGtleSBhcyBFU0Mga2V5CTA9bm8gMT15ZXMNCmtleV9zZXQuCSxhLGIsYyxkLGUsZixnLGgsaSxqLGssbCxtLG4sbyxwLHEscixzLHQsdQlrZXlzIHVzZWQgZm9yIG1lbnVzKHBsZWFzZSBkbyBub3QgcmVtb3ZlIHRoZSBjb21tYSBhdCB0aGUgYmVnaW5uaW5nKQ0KDQooS2V5Ym9hcmQgbW92ZW1lbnQpDQprZXlfbm9ydGguCSI4ICINCmtleV9zb3V0aC4JIjIgIg0Ka2V5X3dlc3QuCSI0ICINCmtleV9lYXN0LgkiNiAiDQprZXlfbm9ydGh3ZXN0LgkiNyAiDQprZXlfbm9ydGhlYXN0LgkiOSAiDQprZXlfc291dGh3ZXN0LgkiMSAiDQprZXlfc291dGhlYXN0LgkiMyAiDQprZXlfd2FpdC4JIjUgIg0KDQooa2V5Ym9hcmQpDQprZXlfbG9vay4JImwiDQprZXlfYWx0ZXIuCSJbIgksIjYiDQprZXlfZXNjLgkiXiIJLCIxMSINCmtleV9pZGVudGlmeS4JIngiDQprZXlfY2FuY2VsLgkiXCIJLCIwIg0Ka2V5X2VudGVyLgkiICIJLCIyIg0Ka2V5X3RhcmdldC4JIioiCSwiNCINCmtleV9wYWdldXAuCSIrIg0Ka2V5X3BhZ2Vkb3duLgkiLSINCmtleV9oZWxwLgkiPyIJLCIxMCINCmtleV9tc2dsb2cuCSIvIg0Ka2V5X2NoYXJhaW5mby4JImMiCSwiOSINCmtleV9nZXQuCSJnIgksIjciDQprZXlfZ2V0Mi4JIjAiDQprZXlfZHJvcC4JImQiDQprZXlfaW52ZW50b3J5LgkiWCINCmtleV9tYXRlcmlhbC4JIm0iDQprZXlfaW50ZXJhY3QuCSJpIg0Ka2V5X2l0ZW1zdGFjay4JIkkiDQprZXlfd2lwZS4JIlciDQprZXlfd2Vhci4JInciDQprZXlfZWF0LgkiZSINCmtleV9mZWVkLgkiRSINCmtleV9jYXN0LgkidiINCmtleV9jbG9zZS4JIkMiDQprZXlfZHJpbmsuCSJxIg0Ka2V5X3JlYWQuCSJyIg0Ka2V5X3phcC4JIloiDQprZXlfZmlyZS4JImYiCSwiNSINCmtleV9nb0Rvd24uCSI+Ig0Ka2V5X2dvVXAuCSI8Ig0Ka2V5X3NhdmUuCSJTIg0Ka2V5X3NlYXJjaC4JInMiDQprZXlfc2tpbGwuCSJhIg0Ka2V5X3Jlc3QuCSJSIg0Ka2V5X2RpZy4JIkQiDQprZXlfYXBwbHkuCSJhIg0Ka2V5X3VzZS4JInQiDQprZXlfYmFzaC4JImIiDQprZXlfb3Blbi4JIm8iDQprZXlfZGlwLgkiQiINCmtleV9wcmF5LgkicCINCmtleV9vZmZlci4JIk8iDQprZXlfam91cm5hbC4JImoiDQprZXlfcXVpY2suCSJ6IgksIjMiDQprZXlfdHJhaXQuCSJGIg0Ka2V5X3Rocm93LgkiVCINCmtleV9naXZlLgkiRyINCmtleV9xdWlja2ludi4JIngiCSwiMSINCmtleV9tb2RlLgkieiINCmtleV9tb2RlMi4JIioiDQprZXlfYW1tby4JIkEiCSwiOCINCnprZXkuCQkiMCINCnhrZXkuCQkiMCINCg0KKERhbWFnZSBQb3B1cCkNCmRtZ1BvcHVwcy4gIjEiDQpkbWdQb3B1cEJ1ZmZIZXguICIxIg0KZG1nUG9wdXBDb24uICIxIg0KZG1nUG9wdXBFdmFkZS4gIjEiDQpkbWdQb3B1cENoYXQuICIwIg0KZG1nUG9wdXBGb250U2l6ZS4gIjEyIg0KZG1nUG9wdXBGb250U2hpZnQuICIwIg0KZG1nUG9wdXBTcGVlZC4gIjIwIg0KZG1nUG9wdXBFeHBsb2RlLiAiMCINCnNob3dOcGNOYW1lLiAiMCINCnNob3dOYW1lQ2hhdE11bHRpbGluZWQuICIxIg0Kc2hvd1BldEhlYWx0aC4gIjAiDQpzaG93RGFtYWdlTWV0ZXIuICIwIg0Kc2hvd0RhbWFnZU1ldGVyVHVybnMuICIzMCINCmF1dG9IaWRlVUkuICIwIg0KDQooQXV0b3BpY2t1cCkNCmF1dG9waWNrLiAiMCINCmF1dG9waWNrX1NvdW5kLiAiMSINCmF1dG9kZXN0cm95X1NvdW5kLiAiMSINCg0KKGF1dG8gZml4KQ0K" | base64 -d > /var/data/config.txt
fi
mkdir /var/data/save
mkdir /var/data/tmp

# Wine environment
export WINEPREFIX="/app/wine/prefix/wine_prefix"
export USER="player"
export WINE_DIRECTORY="/app/wine/runner/wine-9.8-x86/bin"

# Script enviroment
export GAME_EXECUTABLE="C:/Program Files/game/elonaplus2.22/elonapluscgx.exe"

# Run
$WINE_DIRECTORY/wine "$GAME_EXECUTABLE"

# Post-work
rm -rf /var/data/tmp